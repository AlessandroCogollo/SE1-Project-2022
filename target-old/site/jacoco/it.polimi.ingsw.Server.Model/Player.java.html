<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Player.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">AM56</a> &gt; <a href="index.source.html" class="el_package">it.polimi.ingsw.Server.Model</a> &gt; <span class="el_source">Player.java</span></div><h1>Player.java</h1><pre class="source lang-java linenums">package it.polimi.ingsw.Server.Model;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;
import java.util.Optional;

//player class that implements the real methods that changes the model
class Player implements Iterable&lt;Assistant&gt;{

    private final int id;
    private final int towerColor; // 1 black, 2 white, 3 gray
    private final Optional&lt;Player&gt; mate;

    protected final School school;
    private final Collection&lt;Assistant&gt; deck;

    protected final GameInitializer gameInitializer;

    private Assistant activeAssistant;

<span class="fc" id="L22">    Player (int id, int towerColor, Player mate, GameInitializer gameInitializer, School school) {</span>
<span class="fc" id="L23">        this.id = id;</span>
<span class="fc" id="L24">        this.towerColor = towerColor;</span>
<span class="fc" id="L25">        this.mate = Optional.ofNullable(mate);</span>
<span class="fc" id="L26">        this.gameInitializer = gameInitializer;</span>
<span class="fc" id="L27">        this.school = school;</span>
<span class="fc" id="L28">        this.deck = Assistant.getNewAssistantDeck();</span>
<span class="fc" id="L29">        this.activeAssistant = null;</span>
<span class="fc" id="L30">    }</span>

    int getId() {
<span class="fc" id="L33">        return id;</span>
    }

    int getTowerColor() {
<span class="fc" id="L37">        return towerColor;</span>
    }

<span class="nc" id="L40">    School getSchool() {return school;}</span>

    Assistant getActiveAssistant() {
<span class="fc" id="L43">        return activeAssistant;</span>
    }

    boolean hasAssistant (Assistant x){
<span class="fc" id="L47">        return deck.contains(x);</span>
    }

    boolean hasStudent (Color color){
<span class="fc" id="L51">        return school.hasStudentInEntrance(color);</span>
    }

    // play assistant will remove the assistant from the student's deck and set it as is active assistant, that will be changed only in the next planning phase
    void playAssistant (Assistant x){
<span class="fc bfc" id="L56" title="All 2 branches covered.">        if (x != null)</span>
<span class="fc" id="L57">            deck.remove(x);</span>
<span class="fc" id="L58">        activeAssistant = x;</span>
<span class="fc bfc" id="L59" title="All 2 branches covered.">        if (deck.size() == 0)</span>
<span class="fc" id="L60">            gameInitializer.getRoundHandler().setFinalRound();</span>
<span class="fc" id="L61">    }</span>

    // check if the movement is towards his room or to an island
    void moveStudent (Color c, int destinationId){
<span class="pc bpc" id="L65" title="1 of 2 branches missed.">        if (destinationId != -1){</span>
<span class="nc" id="L66">            Color student = school.moveStudentFromEntrance(c);</span>
<span class="nc" id="L67">            gameInitializer.getIslands().addStudentToIsland(student, destinationId);</span>
<span class="nc" id="L68">        }</span>
        else {
<span class="fc" id="L70">            school.moveStudentToRoom(c);</span>
<span class="fc" id="L71">            gameInitializer.getProfessors().updateProfessors();</span>
        }
<span class="fc" id="L73">    }</span>

    // move mother nature calls the appropriate method in board
    void moveMotherNature (int position){
<span class="fc" id="L77">        gameInitializer.getBoard().moveMotherNature(position);</span>
<span class="fc" id="L78">    }</span>

    // choose cloud call the method in school for add all the students
    void chooseCloud (Cloud c){
<span class="fc" id="L82">        school.addStudentFromCloud(c);</span>
<span class="fc" id="L83">    }</span>

    //methods for the board to manage the tower, if it's a game with 4 players there will be some players with the mate attribute not null
    int getTowers (){
<span class="fc bfc" id="L87" title="All 2 branches covered.">        if (mate.isPresent()){</span>
<span class="fc" id="L88">            return mate.get().getTowers();</span>
        }
<span class="fc" id="L90">        return school.getTowers();</span>
    }

    //todo check usage for force stop the execution in win case
    int moveTowerToIsland (int number){
<span class="fc bfc" id="L95" title="All 2 branches covered.">        if (mate.isPresent()){</span>
<span class="fc" id="L96">            return mate.get().moveTowerToIsland(number);</span>
        }
<span class="pc bpc" id="L98" title="1 of 2 branches missed.">        if (school.removeTowers(number)){</span>
<span class="nc" id="L99">            gameInitializer.checkWin();</span>
<span class="nc" id="L100">            return -1;</span>
        }
<span class="fc" id="L102">        return towerColor;</span>
    }

    void receiveTowerFromIsland (int number){
<span class="fc bfc" id="L106" title="All 2 branches covered.">        if (mate.isPresent()){</span>
<span class="fc" id="L107">            mate.get().receiveTowerFromIsland(number);</span>
        }
        else
<span class="fc" id="L110">            school.addTowers(number);</span>
<span class="fc" id="L111">    }</span>

    int getNumberOfStudentInRoomByColor (Color c){
<span class="fc" id="L114">        return school.getNumberOfStudentInRoomByColor(c);</span>
    }

    @Override
    public Iterator&lt;Assistant&gt; iterator() {
<span class="fc" id="L119">        return deck.iterator();</span>
    }


    //factory method for generate all player or advance player if it is an advanced game, with the exception of 4 players
    static Collection&lt;Player&gt; factoryPlayers (int[] ids, GameInitializer gI) {

<span class="fc" id="L126">        Bag bag = gI.getBag();</span>
<span class="fc" id="L127">        int gameMode = gI.getGameMode();</span>

        //generate the collection with the length needed
<span class="fc" id="L130">        Collection&lt;Player&gt; p = new ArrayList&lt;&gt;(ids.length);</span>

        //switch case for number of player that changes the school and color of tower; in each case there's the check for the game mode for create a normal player or an advanced one
<span class="pc bpc" id="L133" title="1 of 4 branches missed.">        switch (ids.length) {</span>
            case 2 -&gt; {
<span class="fc" id="L135">                School school2_1 = new School(8, 7, bag);</span>
<span class="fc" id="L136">                School school2_2 = new School(8, 7, bag);</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">                if (gameMode == 0) {</span>
<span class="fc" id="L138">                    p.add(new Player(ids[0], 1, null, gI, school2_1));</span>
<span class="fc" id="L139">                    p.add(new Player(ids[1], 2, null, gI, school2_2));</span>
                } else {
<span class="fc" id="L141">                    p.add(new AdvancedPlayer(ids[0], 1, null, gI, school2_1));</span>
<span class="fc" id="L142">                    p.add(new AdvancedPlayer(ids[1], 2, null, gI, school2_2));</span>
                }
<span class="fc" id="L144">            }</span>
            case 3 -&gt; {
<span class="fc" id="L146">                School school3_1 = new School(6, 9, bag);</span>
<span class="fc" id="L147">                School school3_2 = new School(6, 9, bag);</span>
<span class="fc" id="L148">                School school3_3 = new School(6, 9, bag);</span>
<span class="fc bfc" id="L149" title="All 2 branches covered.">                if (gameMode == 0) {</span>
<span class="fc" id="L150">                    p.add(new Player(ids[0], 1, null, gI, school3_1));</span>
<span class="fc" id="L151">                    p.add(new Player(ids[1], 2, null, gI, school3_2));</span>
<span class="fc" id="L152">                    p.add(new Player(ids[2], 3, null, gI, school3_3));</span>
                } else {
<span class="fc" id="L154">                    p.add(new AdvancedPlayer(ids[0], 1, null, gI, school3_1));</span>
<span class="fc" id="L155">                    p.add(new AdvancedPlayer(ids[1], 2, null, gI, school3_2));</span>
<span class="fc" id="L156">                    p.add(new AdvancedPlayer(ids[2], 3, null, gI, school3_3));</span>
                }
<span class="fc" id="L158">            }</span>

            // for the case 4 there are 2 types of player, 1 like a normal player in a 2players Game and 1 with no towers, in that case i've added a mate tha can manage the tower
            case 4 -&gt; {
<span class="fc" id="L162">                School school4_1 = new School(8, 7, bag);</span>
<span class="fc" id="L163">                School school4_2 = new School(8, 7, bag);</span>
<span class="fc" id="L164">                School school4s_1 = new School(0, 7, bag); //special school with no tower</span>
<span class="fc" id="L165">                School school4s_2 = new School(0, 7, bag); //special school with no tower</span>
<span class="fc" id="L166">                int iA = 0, iB = 0;</span>
<span class="fc" id="L167">                Player tempA = null, tempB = null;</span>
<span class="fc bfc" id="L168" title="All 2 branches covered.">                if (gameMode == 0) {</span>

<span class="fc bfc" id="L170" title="All 2 branches covered.">                    for (int x : ids) {</span>

                        //that's why the method need that the teammate need the same final bit
<span class="fc bfc" id="L173" title="All 2 branches covered.">                        if (x % 2 == 0) {</span>

                            // the first one of the team get the normal school
<span class="fc bfc" id="L176" title="All 2 branches covered.">                            if (iA == 0) {</span>
<span class="fc" id="L177">                                tempA = new Player(x, 1, null, gI, school4_1); // we save the pointer to that player for the next team member</span>
<span class="fc" id="L178">                                p.add(tempA);</span>
<span class="fc" id="L179">                                iA++;</span>
                            } else {
<span class="fc" id="L181">                                p.add(new Player(x, 1, tempA, gI, school4s_1)); //here we set the mate with the pointer saved</span>
                            }
                        } else {

                            // the same for the other team
<span class="fc bfc" id="L186" title="All 2 branches covered.">                            if (iB == 0) {</span>
<span class="fc" id="L187">                                tempB = new Player(x, 2, null, gI, school4_2);</span>
<span class="fc" id="L188">                                p.add(tempB);</span>
<span class="fc" id="L189">                                iB++;</span>
                            } else {
<span class="fc" id="L191">                                p.add(new Player(x, 2, tempB, gI, school4s_2));</span>
                            }
                        }
                    }
                }

                //exactly the same but with advanced player instead of a normal player
                else {
<span class="fc bfc" id="L199" title="All 2 branches covered.">                    for (int x : ids) {</span>
<span class="fc bfc" id="L200" title="All 2 branches covered.">                        if (x % 2 == 0) {</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">                            if (iA == 0) {</span>
<span class="fc" id="L202">                                tempA = new AdvancedPlayer(x, 1, null, gI, school4_1);</span>
<span class="fc" id="L203">                                p.add(tempA);</span>
<span class="fc" id="L204">                                iA++;</span>
                            } else {
<span class="fc" id="L206">                                p.add(new AdvancedPlayer(x, 1, tempA, gI, school4s_1));</span>
                            }
                        } else {
<span class="fc bfc" id="L209" title="All 2 branches covered.">                            if (iB == 0) {</span>
<span class="fc" id="L210">                                tempB = new AdvancedPlayer(x, 2, null, gI, school4_2);</span>
<span class="fc" id="L211">                                p.add(tempB);</span>
<span class="fc" id="L212">                                iB++;</span>
                            } else {
<span class="fc" id="L214">                                p.add(new AdvancedPlayer(x, 2, tempB, gI, school4s_2));</span>
                            }
                        }
                    }
                }
            }
        }
<span class="fc" id="L221">        return p;</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>